Використано 83% обсягу пам’яті … Якщо сховище буде заповнено, ви не зможете зберігати файли на Диску й автоматично завантажувати медіафайли в Google Фото. Отримайте 30 ГБ сховища на 3 місяці за персоналізованою ціною 20 грн 5 грн за місяць.
WITH all_ads_data AS (
SELECT
ad_date,
t3.campaign_name,
t2.adset_name,
t1.spend,
t1.impressions,
t1.reach,
t1.clicks,
t1.leads,
t1.value,
'Facebook' AS ad_source
FROM facebook_ads_basic_daily AS t1
LEFT JOIN facebook_adset AS t2 ON t1.adset_id = t2.adset_id
LEFT JOIN facebook_campaign AS t3 ON t1.campaign_id = t3.campaign_id
UNION ALL
SELECT
ad_date,
campaign_name,
adset_name,
spend,
impressions,
reach,
clicks,
leads,
value,
'Google' AS ad_source
FROM google_ads_basic_daily
),
montly_reach_camp AS (
SELECT
DATE_PART('year', ad_date) || '-' || DATE_PART('month', ad_date) AS ad_month,
campaign_name,
COALESCE(SUM(reach), 0) AS monthly_reach 
FROM all_ads_data
GROUP BY 1, 2
)
SELECT
*,
monthly_reach - COALESCE(LAG(monthly_reach) OVER (PARTITION BY campaign_name ORDER BY ad_month), 0) AS montly_growth
FROM montly_reach_camp
ORDER BY montly_growth DESC
LIMIT 1
